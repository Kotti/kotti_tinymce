tinymce.PluginManager.add("kottiimage",function(e){var a=[{number:1,text:"span1",value:[60,120]},{number:2,text:"span2",value:[160,320]},{number:3,text:"span3",value:[260,520]},{number:4,text:"span4",value:[360,720]},{number:5,text:"span5",value:[460,920]},{number:6,text:"span6",value:[560,1120]},{number:7,text:"span7",value:[660,1320]},{number:8,text:"span8",value:[760,1520]},{number:9,text:"span9",value:[860,1720]},{number:10,text:"span10",value:[960,1920]},{number:11,text:"span11",value:[1060,2120]},{number:12,text:"span12",value:[1160,2320]}];function f(){var g="";g='<table role="presentation" class="mce-panel mce-grid mce-grid-border">';g+="<tr>";for(var h=0;h<a.length;h++){g+='<td><a href="#" data-mce-index="'+h+'">'+(h+1)+"</a></td>"}g+="</tr>";g+="</table>";g+='<div class="mce-text-center">No Scaling</div>';return g}function d(i,k){var h=document.createElement("img");function g(m,l){h.parentNode.removeChild(h);k({width:m,height:l})}h.onload=function(){g(h.clientWidth,h.clientHeight)};h.onerror=function(){g()};h.src=i;var j=h.style;j.visibility="hidden";j.position="fixed";j.bottom=j.left=0;j.width=j.height="auto";document.body.appendChild(h)}function c(g){return function(){var h=e.settings.image_list;if(typeof(h)=="string"){tinymce.util.XHR.send({url:h,success:function(i){g(tinymce.util.JSON.parse(i))}})}else{g(h)}}}function b(t){var l,z,u=e.dom,i=e.selection.getNode();var s,p,v;function x(){var A=[{text:"None",value:""}];tinymce.each(t,function(B){A.push({text:B.text||B.title,value:B.value||B.url,menu:B.menu})});return A}function h(E){var B,D,C,A;B=l.find("#width")[0];D=l.find("#height")[0];C=B.value();A=D.value();if(l.find("#constrain")[0].checked()&&s&&p&&C&&A){if(E.control==B){A=Math.round((C/s)*A);D.value(A)}else{C=Math.round((A/p)*C);B.value(C)}}s=C;p=A}function q(G,C){var D,A,B,F,E;E="";if(G[-1]==="/"){G=G.slice(0,-1)}if(G){D=G.split("/");if(D.length>2){A=D[D.length-1];if(A.substring(0,4)==="span"){B=parseInt(A.slice(4),10);if(B===C){E=G}else{E=D.slice(0,-1).join("/")+"/span"+C}}else{if(A==="image"){E=G+"/span"+C}}}else{E=G+"/image/span"+C}}return E}function g(){function A(D){function C(){D.onload=D.onerror=null;e.selection.select(D);e.nodeChanged()}D.onload=function(){if(!B.width&&!B.height){u.setAttribs(D,{width:D.clientWidth,height:D.clientHeight})}C()};D.onerror=C}var B=l.toJSON();if(B.width===""){B.width=null}if(B.height===""){B.height=null}if(B.style===""){B.style=null}B={src:B.src,alt:B.alt,width:B.width,height:B.height,style:B.style};if(!i){B.id="__mcenew";e.insertContent(u.createHTML("img",B));i=u.get("__mcenew");u.setAttrib(i,"id",null)}else{u.setAttribs(i,B)}A(i)}function y(A){if(A){A=A.replace(/px$/,"")}return A}function k(B,A){var C;if(B<60){return C}tinymce.each(a,function(D){if(C){if(Math.abs(D.value[0]-B)<Math.abs(C.value[0]-B)){C=D}}else{C=D}});return C}function m(F,C){var D,B;if(F){if(F.match(/image$/)){B="Current Size: Original"}else{if(C&&C>0&&C<a.length+1){B="Current Size: "+C}else{D=F.split("/");if(D.length>0){var A=D[D.length-1];if(A&&A.substring(0,4)==="span"){var E=parseInt(A.slice(4),10);if(E){B="Current Size: "+E}else{B="Current Size: None"}}else{if(A==="image"){B="Current Size: Original"}}}else{B=""}}}}else{if(global_src){return m(global_src)}else{B="CurrentSize: No image selected"}}return B}function o(){d(this.value(),function(A){var B,C;if(A.width&&A.height){l.find("#width").value(A.width);l.find("#height").value(A.height);B=l.find("#src").value();C=k(A.width,A.height);if(C){l.find("#image_scale_label").text(m(B,C.number))}else{l.find("#image_scale_label").text(m(B))}}else{l.find("#width").value("");l.find("#height").value("");l.find("#image_scale_label").text("")}})}s=u.getAttrib(i,"width");p=u.getAttrib(i,"height");global_src=u.getAttrib(i,"src");if(i.nodeName=="IMG"&&!i.getAttribute("data-mce-object")){z={src:u.getAttrib(i,"src"),alt:u.getAttrib(i,"alt"),width:s,height:p}}else{i=null}if(t){v={name:"target",type:"listbox",label:"Image list",values:x(),onselect:function(A){var B=l.find("#alt");if(!B.value()||(A.lastControl&&B.value()==A.lastControl.text())){B.value(A.control.text())}l.find("#src").value(A.control.value())}}}function n(){var A=[];tinymce.each(a,function(B){A.push({text:B.text,value:B.value,menu:B.menu})});return A}function j(){return{type:"panelbutton",text:"Change Size",popoverAlign:"bc-tl",panel:{type:"panel",html:f(),onmousemove:function(D){var C=D.target;if(C.nodeName=="A"){var B,F,A;B=e.dom.getParent(C,"table");F=parseInt(C.getAttribute("data-mce-index"),10);if(F!=this.lastPos){for(var E=0;E<a.length;E++){e.dom.toggleClass(B.rows[0].childNodes[E].firstChild,"mce-active",E<=F)}A=a[F].value;B.nextSibling.innerHTML=""+(F+1)+" (fit within "+A[0]+" x "+A[1]+")";this.lastPos=F}}},onmouseout:function(C){var B=C.target;if(B.nodeName=="A"){var A=e.dom.getParent(B,"table");for(var D=0;D<a.length;D++){e.dom.toggleClass(A.rows[0].childNodes[D].firstChild,"mce-active",false)}A.nextSibling.innerHTML="No scale"}},onclick:function(F){if(F.target.nodeName=="A"){var B,D,I,G;var H,K,L;var C,A,E,J;E=F.target;J=parseInt(E.getAttribute("data-mce-index"),10);F.preventDefault();B=l.find("#src");D=l.find("#image_scale_label");I=l.find("#width");G=l.find("#height");H=B.value();s=parseInt(I.value(),10);p=parseInt(G.value(),10);newImageScale=J+1;newImageSize=a[J].value;L=H;if(H&&newImageScale){L=q(H,newImageScale);B.value(L);C=newImageSize[0];A=newImageSize[1];if(s!==0){A=Math.round((C/s)*p)}I.value(newImageSize[0]);G.value(A);console.log("setting image size",H,L,newImageScale);D.text(m(L,newImageScale))}if(l.find("#show_preview")[0].checked()){g()}this.hide()}}}}}var w=[{name:"src",type:"filepicker",label:"Image Source",tooltip:"An image content item is associated with an image file. Upload a new one, or pick an existing image file.",filetype:"image",autofocus:true,onchange:o},v,{type:"formitem",align:"center",spacing:5,label:"Image Size",items:[{type:"panel",layout:"flex",direction:"column",align:"center",spacing:5,items:[{type:"container",layout:"flex",direction:"row",align:"center",pack:"start",spacing:5,items:[j(),{type:"label",name:"image_scale_label",tooltip:"Size choices (1-12) are relative to the maximum width.",text:m()}]},{type:"container",layout:"flex",direction:"row",align:"center",spacing:5,items:[{type:"label",text:"Width and Height",tooltip:"Optionally, set width and size directly."},{name:"width",tooltip:"In pixels. Use integer number.",type:"textbox",maxLength:3,size:3,onchange:h},{type:"label",text:"x"},{name:"height",tooltip:"In pixels. Use integer number.",type:"textbox",maxLength:3,size:3,onchange:h},{name:"constrain",type:"checkbox",checked:true,tooltip:"Do not distort -- keep original proportions.",text:"Keep aspect ratio"}]}]}]},{name:"show_preview",type:"checkbox",checked:true,tooltip:"Show live preview of image in the edit window.",text:"Show Preview"}];function r(){function C(D){if(D.length>0&&(/^[0-9]+$/).test(D)){D+="px"}return D}var B=l.toJSON();var A=u.parseStyle(B.style);delete A.margin;A["margin-top"]=A["margin-bottom"]=C(B.vspace);A["margin-left"]=A["margin-right"]=C(B.hspace);A["border-width"]=C(B.border);l.find("#style").value(u.serializeStyle(u.parseStyle(u.serializeStyle(A))))}if(e.settings.image_advtab){if(i){z.hspace=y(i.style.marginLeft||i.style.marginRight);z.vspace=y(i.style.marginTop||i.style.marginBottom);z.border=y(i.style.borderWidth);z.style=e.dom.serializeStyle(e.dom.parseStyle(e.dom.getAttrib(i,"style")))}l=e.windowManager.open({title:"Insert/edit image",data:z,bodyType:"tabpanel",body:[{title:"General",type:"form",padding:20,labelGap:30,spacing:10,items:w},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox"},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:r},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:g})}else{l=e.windowManager.open({title:"Edit image",data:z,body:w,onSubmit:g})}}e.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:c(b),stateSelector:"img:not([data-mce-object])"});e.addMenuItem("image",{icon:"image",text:"Insert image",onclick:c(b),context:"insert",prependToContext:true})});